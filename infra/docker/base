FROM ubuntu:17.04

# Need to be able to use add-apt-repository and must run update before
# it'll work
# gettext - Package is needed to use 'envsubst' command.
RUN apt-get update
RUN apt-get -y install software-properties-common curl git nano gettext

# Add NGINX Repo
RUN add-apt-repository ppa:nginx/development
RUN apt-get update
RUN apt-get -y install nginx

# Add Node Repo
RUN curl -sL https://deb.nodesource.com/setup_8.x | bash -
RUN apt-get update
RUN apt-get -y install nodejs

# Remove the default Nginx configuration file
RUN rm /etc/nginx/sites-enabled/default
RUN rm /etc/nginx/sites-available/default

# Setup forever
RUN npm install -g forever
RUN mkdir -p /gauntface/logs/

COPY infra/nginx/gauntface-shared.conf /etc/nginx/gauntface-shared.conf

COPY infra/docker/startup.sh /gauntface/docker/startup.sh
RUN chmod +x /gauntface/docker/startup.sh
CMD /gauntface/docker/startup.sh
